function gestionarXml(e){xmlDoc=e.responseXML;var t="",a=0;for(divNota(),i=0;i<numeroPreguntas;i++)switch(t=xmlDoc.getElementsByTagName("type")[i].innerHTML){case"select":crearDivPregunta(i),crearDivCorreccion(i),imprimirTituloPregunta(i,xmlDoc),imprimirOpcionesSelect(i,xmlDoc),preguntasSelect.push(i),respuestasSelect.push(parseInt(xmlDoc.getElementsByTagName("question")[i].getElementsByTagName("answer")[0].innerHTML)),valorRespuestaSelect.push(xmlDoc.getElementsByTagName("question")[i].getElementsByTagName("option")[respuestasSelect[i]].innerHTML);break;case"text":crearDivPregunta(i),crearDivCorreccion(i),imprimirTituloPregunta(i,xmlDoc),imprimirCajaText(a,xmlDoc),a++,preguntasText.push(i),respuestasText.push(parseInt(xmlDoc.getElementsByTagName("question")[i].getElementsByTagName("answer")[0].innerHTML));break;case"checkbox":crearDivPregunta(i),crearDivCorreccion(i),imprimirTituloPregunta(i,xmlDoc),imprimirCheckBox(i,xmlDoc),preguntasCheckBox.push(i),agregarRespuestas(i,xmlDoc,respuestasCheckBox,valorRespuestasCheckBox);break;case"radio":crearDivPregunta(i),crearDivCorreccion(i),imprimirTituloPregunta(i,xmlDoc),imprimirRadioButton(i,xmlDoc),preguntasRadio.push(i),agregarRespuestasRadio(i,xmlDoc,respuestasRadio,valorRespuestaRadio);break;case"select multiple":crearDivPregunta(i),crearDivCorreccion(i),imprimirTituloPregunta(i,xmlDoc),imprimirSelectMultiple(i,xmlDoc),preguntasSelectMultiple.push(i),agregarRespuestas(i,xmlDoc,respuestasSelectMultiple,valorRespuestasSelectMultiple)}imprimirEspacios(2),imprimirBotonCorregir(),imprimirEspacios(2)}function imprimirTituloPregunta(e,t){var a=document.createElement("h3");a.innerHTML=t.getElementsByTagName("title")[e].innerHTML,document.getElementById("pregunta"+e).appendChild(a)}function imprimirOpcionesSelect(e,t){var a="/questions/question["+(e+1)+"]/option",n=t.evaluate(a,t,null,XPathResult.ANY_TYPE,null),r=n.iterateNext(),i=document.createElement("select");for(i.id="select"+e,document.getElementById("pregunta"+e).appendChild(i);r;){var s=document.createElement("option");s.text=r.innerHTML,i.options.add(s),r=n.iterateNext()}}function imprimirCajaText(e,t){var a=document.createElement("input");a.type="number",a.id="cajaTexto"+e,document.getElementById("pregunta"+i).appendChild(a)}function imprimirCheckBox(e,t){for(var a="/questions/question["+(e+1)+"]/option",n=t.evaluate(a,t,null,XPathResult.ANY_TYPE,null),r=n.iterateNext(),i=0;r;){var s=document.createElement("label"),o=document.createElement("input");s.innerHTML=r.innerHTML,o.type="checkbox",o.name="preg"+e,o.id="preg"+e+"ans"+i,o.setAttribute("class","inputCheckBox"),document.getElementById("pregunta"+e).appendChild(o),document.getElementById("pregunta"+e).appendChild(s),document.getElementById("pregunta"+e).appendChild(document.createElement("br")),r=n.iterateNext(),i++}}function imprimirRadioButton(e,t){for(var a="/questions/question["+(e+1)+"]/option",n=t.evaluate(a,t,null,XPathResult.ANY_TYPE,null),r=n.iterateNext(),i=0;r;){var s=document.createElement("input"),o=r.innerHTML,l=document.createElement("span");l.innerHTML=o,s.type="radio",s.name="preg"+e,s.id="preg"+e+"ans"+i,s.setAttribute("class","inputRadioButton"),document.getElementById("pregunta"+e).appendChild(s),document.getElementById("pregunta"+e).appendChild(l),document.getElementById("pregunta"+e).appendChild(document.createElement("br")),r=n.iterateNext(),i++}}function imprimirSelectMultiple(e,t){var a="/questions/question["+(e+1)+"]/option",n=t.evaluate(a,t,null,XPathResult.ANY_TYPE,null),r=n.iterateNext(),i=document.createElement("select");for(i.multiple="true";r;){var s=r.innerHTML,o=document.createElement("option");o.innerHTML=s,i.appendChild(o),r=n.iterateNext()}document.getElementById("pregunta"+e).appendChild(i)}function imprimirEspacios(e){for(i=0;i<e;i++){var t=document.createElement("br");formContainer.appendChild(t)}}function imprimirBotonCorregir(){var e=document.createElement("input");e.type="submit",e.value="Corregir",e.id="btnCorregir",formContainer.appendChild(e)}function corregirSelect(){for(i=0;i<preguntasSelect.length;i++){var e=document.getElementById("pregunta"+preguntasSelect[i]).getElementsByTagName("select")[0],t=respuestasSelect[i];e.selectedIndex==t?(darRespuestaHtml(preguntasSelect[i],"P"+(preguntasSelect[i]+1)+": Correcto"),nota+=1):(darRespuestaHtml(preguntasSelect[i],"P"+(preguntasSelect[i]+1)+": Incorrecto"),darRespuestaHtml(preguntasSelect[i],"La respuesta correcta es: "+valorRespuestaSelect[i]));var a=xmlDoc.createElement("useranswer");a.innerHTML=e.selectedIndex,xmlDoc.getElementsByTagName("question")[preguntasSelect[i]].appendChild(a)}}function corregirText(){for(i=0;i<preguntasText.length;i++){var e=document.getElementById("pregunta"+preguntasText[i]).getElementsByTagName("input")[0],t=respuestasText[i];e.value==t?(darRespuestaHtml(preguntasText[i],"P"+(preguntasText[i]+1)+": Correcto"),nota+=1):(darRespuestaHtml(preguntasText[i],"P"+(preguntasText[i]+1)+": Incorrecto"),darRespuestaHtml(preguntasText[i],"La respuesta correcta es: "+respuestasText[i]));var a=xmlDoc.createElement("useranswer");a.innerHTML=e.value,xmlDoc.getElementsByTagName("question")[preguntasText[i]].appendChild(a)}}function corregirCheckBox(){for(i=0;i<preguntasCheckBox.length;i++){var e=document.getElementById("pregunta"+preguntasCheckBox[i]).getElementsByTagName("input"),t=0,a=!1;for(j=0;j<e.length;j++){var n=!1;if(e[j].checked){var r=xmlDoc.createElement("useranswer");for(r.innerHTML=j,xmlDoc.getElementsByTagName("question")[preguntasCheckBox[i]].appendChild(r),t=1,k=0;k<respuestasCheckBox[i].length;k++)if(j==respuestasCheckBox[i][k]){nota+=1/respuestasCheckBox[i].length,darRespuestaHtml(preguntasCheckBox[i],"P"+(preguntasCheckBox[i]+1)+" opcion "+(j+1)+": correcta"),n=!0;break}n||(a=!0,nota-=1/respuestasCheckBox[i].length,darRespuestaHtml(preguntasCheckBox[i],"P"+(preguntasCheckBox[i]+1)+" opcion "+(j+1)+": incorrecta"))}}a&&(1==valorRespuestasCheckBox[i].length?darRespuestaHtml(preguntasCheckBox[i],"La respuesta correcta es: "+valorRespuestasCheckBox[i]):darRespuestaHtml(preguntasCheckBox[i],"Las respuestas correctas son: "+valorRespuestasCheckBox[i].join(", "))),0==t&&darRespuestaHtml(preguntasCheckBox[i],"P"+(preguntasCheckBox[i]+1)+": No has seleccionado ninguna respuesta")}}function corregirRadio(){for(i=0;i<preguntasRadio.length;i++){var e=document.getElementById("pregunta"+preguntasRadio[i]),t=0;for(j=0;j<e.getElementsByTagName("input").length;j++)if(e.getElementsByTagName("input")[j].checked){var a=xmlDoc.createElement("useranswer");a.innerHTML=j,xmlDoc.getElementsByTagName("question")[preguntasRadio[i]].appendChild(a),t=1,j==respuestasRadio[i]?(nota+=1,darRespuestaHtml(preguntasRadio[i],"P"+(preguntasRadio[i]+1)+" opcion "+(j+1)+": correcta")):(nota-=1,darRespuestaHtml(preguntasRadio[i],"P"+(preguntasRadio[i]+1)+" opcion "+(j+1)+": incorrecta"),darRespuestaHtml(preguntasRadio[i],"La respuesta correcta es: "+valorRespuestaRadio[i]))}0==t&&darRespuestaHtml(preguntasRadio[i],"P"+(preguntasRadio[i]+1)+": No has seleccionado ninguna respuesta")}}function corregirSelectMultiple(){for(i=0;i<preguntasSelectMultiple.length;i++){var e=document.getElementById("pregunta"+preguntasSelectMultiple[i]).getElementsByTagName("select")[0],t=0,a=!1;for(j=0;j<e.length;j++){var n=!1;if(e[j].selected){var r=xmlDoc.createElement("useranswer");for(r.innerHTML=j,xmlDoc.getElementsByTagName("question")[preguntasSelectMultiple[i]].appendChild(r),t=1,k=0;k<respuestasSelectMultiple[i].length;k++)if(j==respuestasSelectMultiple[i][k]){nota+=1/respuestasSelectMultiple[i].length,darRespuestaHtml(preguntasSelectMultiple[i],"P"+(preguntasSelectMultiple[i]+1)+" opcion "+(j+1)+": correcta"),n=!0;break}n||(a=!0,nota-=1/respuestasSelectMultiple[i].length,darRespuestaHtml(preguntasSelectMultiple[i],"P"+(preguntasSelectMultiple[i]+1)+" opcion "+(j+1)+": incorrecta"))}}a&&(1==valorRespuestasSelectMultiple[i].length?darRespuestaHtml(preguntasSelectMultiple[i],"La respuesta correcta es: "+valorRespuestasSelectMultiple[i]):darRespuestaHtml(preguntasSelectMultiple[i],"Las respuestas correctas son: "+valorRespuestasSelectMultiple[i].join(", "))),0==t&&darRespuestaHtml(preguntasSelectMultiple[i],"P"+(preguntasSelectMultiple[i]+1)+": No has seleccionado ninguna respuesta")}}function agregarRespuestas(e,t,a,n){var r=[],i=[];for(j=0;j<t.getElementsByTagName("question")[e].getElementsByTagName("answer").length;j++)r.push(parseInt(t.getElementsByTagName("question")[e].getElementsByTagName("answer")[j].innerHTML));for(j=0;j<r.length;j++)i.push(t.getElementsByTagName("question")[e].getElementsByTagName("option")[r[j]].innerHTML);a.push(r),n.push(i)}function agregarRespuestasRadio(e,t,a,n){a.push(parseInt(t.getElementsByTagName("question")[e].getElementsByTagName("answer")[0].innerHTML)),n.push(t.getElementsByTagName("question")[e].getElementsByTagName("option")[a[a.length-1]].innerHTML)}function crearDivPregunta(e){var t=document.createElement("div");t.id="pregunta"+e,formContainer.appendChild(t)}function crearDivCorreccion(e){var t=document.createElement("div");t.id="correccion"+e,document.getElementById("resultadosDiv").appendChild(t)}function darRespuestaHtml(e,t){var a=document.createElement("p"),n=document.createTextNode(t);a.appendChild(n),document.getElementById("correccion"+e).appendChild(a)}function presentarNota(){var e=document.createElement("p"),t=document.createTextNode("Nota: "+nota.toFixed(2)+" punts sobre 10");e.appendChild(t),document.getElementById("nota").appendChild(e),5>nota?document.getElementById("nota").style.color="#333333":document.getElementById("nota").style.color="green"}function presentarTablaXSL(){document.getElementById("tablaResultados").style.display="block",document.implementation&&document.implementation.createDocument&&(xsltProcessor=new XSLTProcessor,xsltProcessor.importStylesheet(xslDoc),resultDocument=xsltProcessor.transformToFragment(xmlDoc,document),document.getElementById("tablaResultados").appendChild(resultDocument));for(var e=formContainer,t=e.elements,a=0,n=t.length;n>a;++a)t[a].disabled=!0}function divNota(){var e=document.createElement("div");e.id="nota",document.getElementById("resultadosDiv").appendChild(e)}function ocultarDivRespuestas(){for(i=0;i<numeroPreguntas;i++)document.getElementById("correccion"+i).style.display="none"}function comprobar(){for(i=0;i<preguntasText.length;i++){var e=document.getElementById("pregunta"+preguntasText[i]).getElementsByTagName("input")[0];if(""==e.value)return e.focus(),alert("Escribe un numero en la pregunta "+preguntasText[i]),!1}return document.getElementById("resultadosDiv").style.display="block",!0}var xmlDoc=null,xslDoc=null,formContainer=null,nota=0,numeroPreguntas=10,preguntasSelect=[],respuestasSelect=[],valorRespuestaSelect=[],preguntasText=[],respuestasText=[],preguntasCheckBox=[],respuestasCheckBox=[],valorRespuestasCheckBox=[],preguntasRadio=[],respuestasRadio=[],valorRespuestaRadio=[],preguntasSelectMultiple=[],respuestasSelectMultiple=[],valorRespuestasSelectMultiple=[];window.onload=function(){formContainer=document.getElementById("myform"),formContainer.onsubmit=function(){return comprobar()&&(document.getElementById("myform").style.display="none",document.getElementById("resultadosDiv"),document.getElementById("menu").focus(),ocultarDivRespuestas(),corregirSelect(),corregirText(),corregirCheckBox(),corregirRadio(),corregirSelectMultiple(),presentarNota(),presentarTablaXSL()),!1};var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&gestionarXml(this)},e.open("GET","xml/preguntas.xml",!0),e.send(),e=new XMLHttpRequest,e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(xslDoc=this.responseXML)},e.open("GET","xml/preguntas.xsl",!0),e.send()},window.onmousedown=function(e){var t=e.target;if("option"==t.tagName.toLowerCase()&&t.parentNode.hasAttribute("multiple")){e.preventDefault(),t.hasAttribute("selected")?t.removeAttribute("selected"):t.setAttribute("selected","");var a=t.parentNode.cloneNode(!0);t.parentNode.parentNode.replaceChild(a,t.parentNode)}};